mirror_to_github:
  stage: deploy
  image: alpine:latest
  variables:
    GIT_STRATEGY: none
  only:
    - main  # Change this to your default branch if different
    - tags  # Optional: also mirror when you create tags
  before_script:
    - apk update && apk add git openssh-client
    - mkdir -p ~/.ssh
    - echo "${SSH_PRIVATE_KEY}" > ~/.ssh/id_rsa
    - chmod 600 ~/.ssh/id_rsa
    - ssh-keyscan github.com >> ~/.ssh/known_hosts
    - git config --global user.name "${GITLAB_USER_NAME}"
    - git config --global user.email "${GITLAB_USER_EMAIL}"
  script:
    - git clone --mirror https://oauth2:${CI_JOB_TOKEN}@gitlab.com/${CI_PROJECT_PATH}.git repo-mirror
    - cd repo-mirror
    - git remote add github https://${GITHUB_USERNAME}:${GITHUB_TOKEN}@github.com/${GITHUB_USERNAME}/${GITHUB_REPO}.git
    - git push --mirror github
    - echo "Successfully mirrored repository to GitHub"